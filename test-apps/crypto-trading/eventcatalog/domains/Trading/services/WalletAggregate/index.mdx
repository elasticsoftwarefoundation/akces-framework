---
id: WalletAggregate
version: 1.0.0
name: Wallet Aggregate
summary: |
  Core aggregate that manages (crypto) currency wallet operations
owners:
    - jwijgerd
    - framework-developers
receives:
  - id: CreateWallet
    version: 1.0.0
  - id: AccountCreated
    version: 1.0.0
sends:
  - id: AmountReserved
    version: 1.0.0
  - id: WalletCreated
    version: 1.0.0
repository:
  language: Java
  url: https://github.com/elasticsoftwarefoundation/akces-framework/test-apps/crypto-trading/eventcatalog/domains/Trading/services/WalletAggregate
---



import Footer from '@catalog/components/footer.astro';

## Overview

The WalletAggregate is responsible for managing cryptocurrency wallets, handling operations such as wallet creation, deposits, withdrawals, and fund reservations for pending transactions.

<Tiles>
    <Tile icon="DocumentIcon" href={`/docs/services/${frontmatter.id}/${frontmatter.version}/changelog`} title="View the changelog" description="View the history and evolution of this service" />
    <Tile icon="UserGroupIcon" href="/docs/teams/framework-developers" title="Contact the team" description="Questions? Contact the service owners" />
    <Tile icon="BoltIcon" href={`/visualiser/services/${frontmatter.id}/${frontmatter.version}`} title={`Sends ${frontmatter.sends.length} messages`} description="This service emits events to notify downstream consumers" />
    <Tile icon="BoltIcon" href={`/visualiser/services/${frontmatter.id}/${frontmatter.version}`} title={`Receives ${frontmatter.receives.length} commands`} description="This service processes commands to manage wallet state" />
</Tiles>

## Architecture diagram

<NodeGraph title="WalletAggregate Service Flow" />

## Key Features

- **Wallet Creation**: Creates new cryptocurrency wallets for users
- **Fund Management**: Handles deposits and withdrawals of funds
- **Reserve Funds**: Temporarily reserves funds for pending transactions
- **Balance Tracking**: Maintains accurate wallet balances across operations

## Commands

The WalletAggregate processes the following commands:

| Command | Description |
|---------|-------------|
| CreateWallet | Creates a new cryptocurrency wallet for a user |
| DepositFunds | Adds funds to a user's existing wallet |
| WithdrawFunds | Removes funds from a user's wallet |

## Events

The WalletAggregate emits the following events:

| Event | Description |
|-------|-------------|
| WalletCreatedEvent | Emitted when a new wallet is created |
| FundsDepositedEvent | Signals successful fund deposits |
| FundsWithdrawnEvent | Signals successful fund withdrawals |
| AmountReserved | Indicates funds have been reserved for a pending transaction |

## Integration Guide

To interact with the WalletAggregate:

1. **Creating a Wallet**: Send a CreateWallet command with user information and initial balance
2. **Managing Funds**: Use DepositFunds and WithdrawFunds commands to modify balances
3. **Monitoring Activities**: Subscribe to the relevant events to track wallet operations

## Implementation Details

The WalletAggregate is implemented using the AKCES Framework's aggregate pattern, providing:

- Strong consistency for financial transactions
- Complete audit trail through event sourcing
- Validation of sufficient funds for withdrawals
- Prevention of double-spending through proper reservations

<Footer />